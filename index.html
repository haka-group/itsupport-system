<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HAKA Group Support</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
    <style>
        :root { --primary: linear-gradient(135deg, #166e48 0%, #0d4d32 100%); --bg: #f0f4f3; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .container { background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 100%; max-width: 500px; }
        .logo { text-align: center; margin-bottom: 20px; }
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; width: 100%; max-width: 500px; }
        .tab { flex: 1; padding: 12px; border: none; border-radius: 12px; cursor: pointer; background: #ddd; font-weight: 600; }
        .tab.active { background: var(--primary); color: white; }
        .group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; color: #666; font-size: 14px; }
        input, select, textarea { width: 100%; padding: 12px; border: 1.5px solid #eee; border-radius: 10px; box-sizing: border-box; background: #fafafa; }
        button { width: 100%; background: var(--primary); color: white; padding: 14px; border: none; border-radius: 12px; cursor: pointer; font-weight: 600; margin-top: 10px; }
        .result-box { display: none; margin-top: 20px; padding: 20px; border-radius: 15px; background: #eef7f2; border: 2px dashed #166e48; text-align: center; }
        #trackDisplay { margin-top: 15px; padding: 15px; border-radius: 10px; background: #f9f9f9; border: 1px solid #eee; display: none; }
    </style>
</head>
<body>

<div class="tabs">
    <button class="tab active" id="t1" onclick="tab('s-tab')">New Ticket</button>
    <button class="tab" id="t2" onclick="tab('t-tab')">Track</button>
</div>

<div class="container" id="s-tab">
    <div class="logo"><img src="https://i.postimg.cc/Y98Km4rh/Whats-App-Image-2026-01-22-at-14-13-49.png" width="160"></div>
    <form id="f-emp">
        <div class="group"><label>Employee Full Name</label><input type="text" id="n" required></div>
        <div class="group">
            <label>Company</label>
            <select id="c" required>
                <option value="">Please Select</option>
                <option value="Haka group">Haka group</option>
                <option value="Rikaz">Rikaz</option>
                <option value="zaya">zaya</option>
                <option value="Fadeco">Fadeco</option>
                <option value="HFI">HFI</option>
                <option value="GH Transport">GH Transport</option>
                <option value="Haka resources">Haka resources</option>
                <option value="Haka Properties">Haka Properties</option>
                <option value="GIMA">GIMA</option>
                <option value="azdan">azdan</option>
                <option value="salyl">salyl</option>
                <option value="Haka foundation">Haka foundation</option>
            </select>
        </div>
        <div class="group">
            <label>Department</label>
            <select id="d" required>
                <option value="">Please Select</option>
                <option value="Finance">Finance</option>
                <option value="IT">IT</option>
                <option value="CC">CC</option>
                <option value="Operation">Operation</option>
                <option value="Marketing">Marketing</option>
                <option value="Sales">Sales</option>
                <option value="Admin">Admin</option>
                <option value="Logistics">Logistics</option>
            </select>
        </div>
        <div class="group"><label>Description</label><textarea id="ds" rows="3" required></textarea></div>
        <div class="group"><label>Attachment (Image)</label><input type="file" id="fi" accept="image/*"></div>
        <div class="group"><label>Contact Info</label><input type="text" id="cont" required></div>
        <button type="submit" id="sub">Submit Request</button>
    </form>
    <div id="ok" class="result-box">
        <p style="margin:0; color:#666;">Ticket Submitted!</p>
        <p style="font-size: 14px; margin: 5px 0;">Your Ticket Number is:</p>
        <strong id="tid" style="font-size: 28px; color: #166e48; letter-spacing: 2px;"></strong>
    </div>
</div>

<div class="container" id="t-tab" style="display:none;">
    <div class="logo"><img src="https://i.postimg.cc/Y98Km4rh/Whats-App-Image-2026-01-22-at-14-13-49.png" width="160"></div>
    <div class="group"><label>Enter Ticket Number</label><input type="text" id="tin" placeholder="Ex: 15"></div>
    <button onclick="track()">Check Status</button>
    <div id="trackDisplay"></div>
</div>

<script>
    const K = "206e0323237ddb0e6a23caea54d37af3";
    const T = "patSfE4E7BGq95o5V.765ef3c9e82a7fb6fe26152bd2e696c5224ebb2cd0593b1a955b38f9eaf2cad0";
    const B = "appyQQt9Dg0MP0zVK";
    const L = "it system 2";

    function tab(x){
        document.getElementById('s-tab').style.display = x === 's-tab' ? 'block' : 'none';
        document.getElementById('t-tab').style.display = x === 't-tab' ? 'block' : 'none';
        document.getElementById('t1').classList.toggle('active', x === 's-tab');
        document.getElementById('t2').classList.toggle('active', x === 't-tab');
    }

    document.getElementById('f-emp').onsubmit = async (e) => {
        e.preventDefault();
        const b = document.getElementById('sub');
        b.disabled = true; 
        b.innerText = "Processing...";
        
        let u = "No Attachment";
        const f = document.getElementById('fi').files[0];
        
        if(f){
            b.innerText = "Uploading Image...";
            const fd = new FormData(); 
            fd.append("image", f);
            try {
                const r = await fetch(`https://api.imgbb.com/1/upload?key=${K}`, {method:'POST', body:fd});
                const j = await r.json(); 
                if(j.success) u = j.data.url;
            } catch(e) {}
        }

        b.innerText = "Saving Ticket...";
        const now = new Date().toISOString();
        const p = {
            fields: {
                "Employee Full Name": document.getElementById('n').value,
                "Company": document.getElementById('c').value,
                "Department": document.getElementById('d').value,
                "Description": document.getElementById('ds').value,
                "Attachment": u,
                "Contact Info": document.getElementById('cont').value,
                "Status": "Incomplete"
                "Submission Time": now
            }
        };

        const res = await fetch(`https://api.airtable.com/v0/${B}/${encodeURIComponent(L)}`, {
            method: 'POST',
            headers: { 'Authorization': `Bearer ${T}`, 'Content-Type': 'application/json' },
            body: JSON.stringify(p)
        });
        
        if(res.ok){
            const rj = await res.json();
            document.getElementById('ok').style.display = 'block';
            document.getElementById('tid').innerText = "#" + rj.fields["Ticket ID"];
            e.target.reset();
        } else { 
            alert("Error submitting request."); 
        }
        b.disabled = false; 
        b.innerText = "Submit Request";
    };

    async function track(){
        const i = document.getElementById('tin').value.trim();
        const o = document.getElementById('trackDisplay');
        if(!i) return;
        o.style.display = 'block'; o.innerHTML = "Searching...";
        
        const query = encodeURIComponent(`{Ticket ID}='${i}'`);
        const res = await fetch(`https://api.airtable.com/v0/${B}/${encodeURIComponent(L)}?filterByFormula=${query}`, { 
            headers: { 'Authorization': `Bearer ${T}` } 
        });
        const j = await res.json();
        
        if(j.records && j.records.length > 0){
            const rec = j.records[0].fields;
            o.innerHTML = `<div style="border-left:4px solid #166e48; padding-left:10px;">
                <p><strong>Status:</strong> ${rec.Status || 'Incomplete'}</p>
                <p><strong>IT Agent:</strong> ${rec["Handled By IT"] || 'Unassigned'}</p>
                <p><strong>Feedback:</strong> ${rec["Resolution Note"] || 'No feedback yet'}</p>
            </div>`;
        } else { o.innerHTML = "Ticket number not found."; }
    }
</script>
</body>
</html>
